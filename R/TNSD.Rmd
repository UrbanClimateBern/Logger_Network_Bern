---
title: "TNSD"
author: "Moritz Burger & Noémie Wellinger"
date: "`r Sys.Date()`"
output: html_document
---

```{r libraries, include = F}
library(caret)
library(dplyr)
library(ggplot2)
#library(ggthemes)
library(raster)
library(ggnewscale)
```


```{r get_data, include = F}
TNSD <- read.csv("../data/Analysis 2023/Summary_T_2023_MJJAS.csv") |>
  select(Log_name, Log_NR, Tropical_nights, Hot_days, total_valid_days, NORD_CHTOPO, OST_CHTOPO) |>
  drop_na()

```

```{r prepare_map, include = F}
LUmap <- raster("../data/Tiffs/Background_20_WGS84.tif")
LUmap <- as.data.frame(LUmap, xy=T)

# LUmap <- aggregate(LUmap, fact=2)
# LUmap<- as.data.frame(LUmap, xy = TRUE)
# LUmap<-filter(LUmap, LU_Raster_20==1)

colorscheme2<-c("white","yellow", "orange", "#bd0026","#550011")
colorscheme<-c("darkgreen","green","beige", "grey", "black")
colorscheme3<-c("#ffffb2", "#fed976", "#feb24c", "#fd8d3c", "#f03b20", "#bd0026")
colorscheme4 <- c("#FFFFFF", "#CCFFFF", "#BBAAFF", "#8833FF", "#8800CC", "#550028")
colorscheme5 <- c("#CC9933", "#FFEE00", "#AAFF00", "#22BB22", "#004400")

# color scheme for LUmap:
# 1= Buildings    grey
# 2= Sealed       grey
# 3= Garden       darkolivegreen1
# 4= Acriculture  darkolivegreen1
# 5= Forest       darkgreen
# 6= Water        lightblue
value_colors <- c("grey", "grey", "lightgrey", "lightgrey", "darkgrey", "lightblue")

```


#Plotting
```{r map_TN, echo = F}
TN_map <-
  ggplot()+
  geom_raster(data = LUmap, aes(x = x, y = y, fill = as.factor(Background_20_WGS84))) +
    scale_fill_manual(values = value_colors, na.value = "white", guide = F) +
  new_scale_fill() +
  geom_point(data=TNSD, 
             aes(x=OST_CHTOPO, y=NORD_CHTOPO, fill=Tropical_nights), 
             colour="black", size=8, pch=21) +
  labs(title="Berner Tropennächte 2023") +
  scale_fill_stepsn(limits=c(-1,12), breaks=c(0,2,4,6,8,10,12), 
                    labels=c("0","1 - 2","3 - 4","5 - 6","7 - 8","9 - 10","> 10"),
                    colors = colorscheme4, name="Anzahl", guide="legend") +
  theme_minimal() +
  theme(panel.grid =element_blank(),
        axis.ticks = element_blank(),
        axis.text = element_blank(),
        axis.title = element_blank(),
        legend.position=c(0.1,0.185),
        legend.background=element_rect(fill="white", color="black"),
        legend.key.size=(unit(0.8, "cm")),
        legend.text=element_text(size=14),
        plot.title = element_text(hjust=0.5, margin=margin(b=-20,t=5) ,size=18))

TN_map
```

```{r map_SD, echo = F}
HD_map<-
  ggplot()+
  geom_raster(data = LUmap, aes(x = x, y = y, fill = as.factor(Background_20_WGS84))) +
    scale_fill_manual(values = value_colors, na.value = "white", name=NULL, guide = F) +
  new_scale_fill() +
  geom_point(data=TNSD, 
             aes(x=OST_CHTOPO, y=NORD_CHTOPO, fill=Hot_days), 
             colour="black", size=8, pch=21) + 
  labs(title="Berner Hitzetage 2023")+
  scale_fill_stepsn(limits=c(0,50), breaks=c(10,20,30,40,50), 
                    labels=c("< 10","11 - 20","21 - 30","31 - 40",">40"),
                    colors = colorscheme2, name="Anzahl", guide="legend")+
  theme_minimal()+
  theme(panel.grid =element_blank(),
        axis.ticks = element_blank(),
        axis.text = element_blank(),
        axis.title = element_blank(),
        legend.position=c(0.105,0.15),
        legend.background=element_rect(fill="white", color="black"),
        legend.key.size=(unit(0.8, "cm")),
        legend.text=element_text(size=14),
        plot.title = element_text(hjust=0.5, margin=margin(b=-20,t=5) ,size=18))

HD_map
```

```{r map_VD, echo = TRUE}
VD_map<-
  ggplot()+
  geom_raster(data = LUmap, aes(x = x, y = y, fill = as.factor(Background_20_WGS84))) +
    scale_fill_manual(values = value_colors, na.value = "white", name=NULL, guide = F) +
  new_scale_fill() +
  geom_point(data=TNSD, 
             aes(x=OST_CHTOPO, y=NORD_CHTOPO, fill=total_valid_days), 
             colour="black", size=8, pch=21) + 
  labs(title="Messtage mit > 80% Datenabdeckung (Juni-August)")+
  scale_fill_stepsn(limits=c(0,145), breaks=c(20,50,80,123,124), 
                    labels=c("< 20","21 - 50","50 - 80","81 - 123","124 (alle)"),
                    colors = colorscheme5, name="Anzahl", guide="legend")+
  theme_minimal()+
  theme(panel.grid =element_blank(),
        axis.ticks = element_blank(),
        axis.text = element_blank(),
        axis.title = element_blank(),
        legend.position=c(0.116,0.15),
        legend.background=element_rect(fill="white", color="black"),
        legend.key.size=(unit(0.8, "cm")),
        legend.text=element_text(size=14),
        plot.title = element_text(hjust=0.5, margin=margin(b=-20,t=5) ,size=18))

VD_map
```


```{r export, include = F}
ggsave("TN_map.jpg", TN_map, path="../figures/2023", width=10, height=9.5375)
ggsave("HD_map.jpg", HD_map, path="../Figures/2023", width=10, height=9.5375)
ggsave("VD_map.jpg", VD_map, path="../Figures/2023", width=10, height=9.5375)
```



